<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hand State Detection</title>
    <link rel="manifest" href="data:application/manifest+json,%7B%22name%22%3A%20%22daw%22%2C%20%22short_name%22%3A%20%22daw%22%2C%20%22start_url%22%3A%20%22index.html%22%2C%20%22display%22%3A%20%22standalone%22%2C%20%22background_color%22%3A%20%22%23ffffff%22%2C%20%22theme_color%22%3A%20%22%23000000%22%2C%20%22scope%22%3A%20%22/%22%2C%20%22offline_enabled%22%3A%20true%2C%20%22prefer_related_applications%22%3A%20false%2C%20%22lang%22%3A%20%22ua%22%2C%20%22related_applications%22%3A%20%5B%5D%7D" />
    <script src="https://cdn.jsdelivr.net/npm/handtrackjs@latest/dist/handtrack.min.js"></script>
</head>

<body>

    <style>
        body {
            background-color: black;
        }

        #video {
            position: absolute;
            left: 0;
            top: 0;
            width: 50%;
            height: 100%;
            z-index: -2;
        }

        #video2 {
            position: absolute;
            right: 0;
            top: 0;
            width: 50%;
            height: 100%;
        }

        #time {
            position: fixed;
            bottom: 10%;
            left: 70%;
            width: 100px;
            height: 40px;
            color: black;
            text-align: center;
            z-index: 2;
            background-color: rgb(192, 192, 192);
            border-radius: 20px;
        }

        video::-webkit-media-controls {
            display: none;
        }

        #cameraSelect {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1;
        }
    </style>

    <h1 id="time"></h1>
    <select id="cameraSelect"></select>

    <video autoplay muted playsinline class="video" id="video"></video>
    <video autoplay muted playsinline class="video" id="video2"></video>

    <script>
        document.addEventListener('DOMContentLoaded', startHandTracking);

        let currentCameraIndex = 0; // Index of the currently used camera
        let cameras = []; // Array to store available cameras
        let videoElements = []; // Array to store video elements

        function startHandTracking() {
            const timeElement = document.getElementById('time');
            const cameraSelect = document.getElementById('cameraSelect');

            // Enumerate devices to get the list of cameras
            navigator.mediaDevices.enumerateDevices()
                .then(devices => {
                    cameras = devices.filter(device => device.kind === 'videoinput');

                    if (cameras.length > 0) {
                        videoElements = document.querySelectorAll('.video');

                        cameras.forEach((camera, index) => {
                            const option = document.createElement('option');
                            option.value = index;
                            option.textContent = `Camera ${index + 1}`;
                            cameraSelect.appendChild(option);
                        });

                        cameraSelect.addEventListener('change', switchCamera);

                        videoElements.forEach((video, index) => {
                            startCamera(video, index);
                        });

                        setInterval(() => {
                            var time = new Date();
                            let h = time.getHours();
                            let m = time.getMinutes();

                            timeElement.textContent = `${h}:${m}`;
                        }, 1000);
                        setTimeout(() => {
                            document.getElementById("video").style.height = '100%';
                            document.getElementById("video2").style.height = '100%';
                        }, 100);
                    } else {
                        console.error('No video devices found.');
                    }
                })
                .catch(error => {
                    console.error('Error enumerating devices:', error);
                });
        }

        function startCamera(video, index) {
            const videoConstraints = {
                deviceId: cameras[currentCameraIndex].deviceId, // Use the currently selected camera
            };

            navigator.mediaDevices.getUserMedia({ video: videoConstraints })
                .then(stream => {
                    video.srcObject = stream;
                })
                .catch(error => {
                    console.error(`Unable to start video stream ${index + 1}.`, error);
                });
        }

        function switchCamera() {
            currentCameraIndex = parseInt(cameraSelect.value);

            videoElements.forEach((video, index) => {
                startCamera(video, index);
            });
        }

    </script>
</body>

</html>
